---
# Pre-commit hook configuration (local mode).
# Uses system-installed tools directly — no network downloads required.
#
# Required tools (install once):
#   brew install shellcheck actionlint hadolint shfmt gitleaks golangci-lint ruff swiftformat swiftlint clang-format ktlint google-java-format kube-linter tflint checkmake powershell
#   pip3 install yamllint ansible-core ansible-lint sqlfluff semgrep
#   npm install -g markdownlint-cli2 prettier editorconfig-checker cspell eslint @stoplight/spectral-cli @commitlint/cli @commitlint/config-conventional stylelint @taplo/cli
#
# Setup (one-time per machine):
#   pip3 install pre-commit
#   pre-commit install
#
# Run manually against all files:
#   pre-commit run --all-files
exclude: '^(\.git|node_modules|\.venv|venv|env|vendor|dist|build|out|target|\.next|\.nuxt|\.output|__pycache__|\.specify)/'

repos:
  - repo: local
    hooks:
      # ── Secret Scanning ────────────────────────────────────────────────────
      - id: gitleaks
        name: gitleaks
        language: system
        entry: gitleaks protect --verbose --redact --staged --gitleaks-ignore-path .gitleaksignore
        pass_filenames: false

      # ── Go ─────────────────────────────────────────────────────────────────
      - id: gofmt
        name: gofmt
        language: system
        entry: gofmt -w
        types: [go]

      # ── YAML ──────────────────────────────────────────────────────────────
      - id: yamllint
        name: yamllint
        language: system
        entry: yamllint
        args: [--config-file, .yamllint.yml]
        types: [yaml]

      # ── Markdown ───────────────────────────────────────────────────────────
      - id: markdownlint-cli2
        name: markdownlint-cli2
        language: system
        entry: markdownlint-cli2
        args: [--fix]
        types: [markdown]

      # ── JSON / YAML / Vue / React / JS / TS formatting ───────────────────────────
      - id: prettier
        name: prettier
        language: system
        entry: prettier
        args: [--write]
        types_or: [json, yaml, vue, javascript, jsx, ts, tsx]

      # ── EditorConfig ───────────────────────────────────────────────────────
      - id: editorconfig-checker
        name: editorconfig-checker
        language: system
        entry: editorconfig-checker
        args:
          - -exclude
          - '(\.(venv|git|github/agents|agent|agents|roo|claude|qwen|amazonq|augment|bob|codebuddy|codex|kilocode|opencode|qoder|shai|cursor|windsurf|pearai|pi|pochi|specify|supermaven|tabnine|trae|vibe|void|zed|zencoder|openhands|cody|coderabbit|aide|cline|clinerules|cursorrules|pr_agent.toml|tabnine|supermaven|vibe|void|zed)/.*)|((node_modules|venv|env|dist|build|out|target|vendor|__pycache__|\.specify)/.*)|(\.aider\.conf\.yml)'

      # ── Spell & Link Checker ───────────────────────────────────────────────
      - id: cspell
        name: cspell
        language: system
        entry: cspell
        args: [--no-progress, --no-summary, --dot]
        types: [text]

      # ── Python ───────────────────────────────────────────────────────────────
      - id: ruff
        name: ruff check
        language: system
        entry: ruff check --fix
        types_or: [python, pyi]

      - id: ruff-format
        name: ruff format
        language: system
        entry: ruff format
        types_or: [python, pyi]

      # ── Apple Ecosystem (Obj-C / C++) ──────────────────────────────────────
      - id: clang-format
        name: clang-format
        language: system
        entry: clang-format -i
        types_or: [objective-c, c, c++]

      # ── API Contracts & Specifications ───────────────────────────────────────
      - id: spectral
        name: spectral
        language: system
        entry: spectral lint
        types_or: [json, yaml]
        files: '(?i)(openapi|swagger|asyncapi).*\.(json|yaml|yml)$'
        pass_filenames: true

      # ── JavaScript / TypeScript / Vue / React ───────────────────────────────────
      - id: eslint
        name: eslint
        language: system
        entry: npx eslint
        args: [--fix]
        types_or: [javascript, ts, tsx, jsx, vue]

      - id: stylelint
        name: stylelint
        language: system
        entry: npx stylelint --fix
        types_or: [css, scss, less]

      - id: taplo
        name: taplo
        language: system
        entry: npx @taplo/cli format
        types: [toml]

      # ── Shell Scripts ──────────────────────────────────────────────────────
      - id: shellcheck
        name: shellcheck
        language: system
        entry: shellcheck
        types: [shell]

      # ── Shell Scripts Formatting ───────────────────────────────────────────
      - id: shfmt
        name: shfmt
        language: system
        entry: shfmt
        args: [-w, -s, -l]
        types: [shell]

      # ── Dockerfile ─────────────────────────────────────────────────────────
      - id: hadolint
        name: hadolint
        language: system
        entry: hadolint
        files: Dockerfile

      # ── Git Commit Message Flow ──────────────────────────────────────────────
      - id: commitlint
        name: commitlint
        language: system
        entry: commitlint --edit
        stages: [commit-msg]
