# R Development Guidelines

> Objective: Define standards for reproducible, clean, and collaborative R code (data science and statistics).

## 1. Project Structure

- Use the **`{renv}`** package for dependency management. Create `renv.lock` and commit it to version control for fully reproducible environments.
- Use the **`{targets}`** pipeline framework for complex, multi-step data analyses. It caches intermediate results and only re-runs what changed.
- Organize projects with a clear directory structure:
  ```
  R/                   # Functions and scripts
  data/raw/            # Original, immutable raw data (never modified)
  data/processed/      # Transformed data (generated by scripts)
  output/              # Figures, tables, reports (generated output)
  reports/             # R Markdown / Quarto documents
  tests/testthat/      # Unit tests
  ```
- Never modify raw data files directly. All transformations must be scripted and reproducible.

## 2. Code Style

- Follow the **tidyverse style guide**. Use `snake_case` for all variable and function names.
- Use the native **pipe operator** (`|>`, R ≥ 4.1) for readable data transformation chains. Use `%>%` (magrittr) only in pre-4.1 projects.
- Limit line length to **80 characters**. Split long function calls onto multiple lines for readability.
- Lint with **`{lintr}`** in CI. Use `{styler}` for automatic code formatting.

## 3. Functions & Validation

- Write small, single-purpose functions. Avoid functions longer than ~30 lines — extract helpers.
- Document all exported functions (in packages) with **`{roxygen2}`** (`#'` comments) including `@param`, `@return`, and `@examples`.
- Use `stopifnot()` or **`{checkmate}`** for input validation at the start of functions.
- **Avoid `<<-`** (global assignment from within a function). It creates hidden state and makes code difficult to test.

## 4. Reproducibility

- Set a random seed (`set.seed(42)`) at the start of any script or function involving randomness.
- Use **R Markdown** or **Quarto** for all reports combining code, output, and narrative. Render reports in CI to verify they run cleanly.
- Use **`{here}`** package (`here::here("data", "raw", "file.csv")`) for all file paths — never hardcode absolute paths.

## 5. Data Handling & Testing

- Use **`{dplyr}`**, **`{tidyr}`**, and **`{purrr}`** for data manipulation and functional programming.
- Prefer `readr::read_csv()` over base R `read.csv()` for consistent column type inference, faster parsing, and explicit encoding handling.
- Write unit tests for functions with **`{testthat}`**. Test edge cases: empty data frames, NA values, single-row inputs.
- Use **`{vdiffr}`** for snapshot testing of plots and **`{mockery}`** for mocking in tests.
